{% extends 'base.html' %}

{% block breadcrumb %}
<ul class="breadcrumb">
    <li><a href="/"><i class="fas fa-home"></i></a></li>
    <li>Configuração</li>
    <li>Projeto</li>
</ul>
{% endblock %}

{% block title %}Cadastro de Projeto{% endblock %}

{% block content %}
<div class="content">
    <div class="top-bar">
        <h2>Cadastro de Projeto</h2>
    </div>

    <div class="form-card">
        <h3 class="section-form-title">Informações do projeto</h3>

        <form id="formProjeto" method="POST" action="{{ url_for('projeto_bp.cadastrar_projeto') }}" class="form-grid">

            <!-- Campos do Projeto -->
            <div class="form-group">
                <label for="codigo_projeto">Código Projeto <span class="required">*</span></label>
                <input type="text" id="codigoProjeto" name="codigo_projeto" required>
            </div>

            <div class="form-group">
                <label for="nome_projeto">Nome Projeto <span class="required">*</span></label>
                <input type="text" id="nome_projeto" name="nome_projeto" required>
            </div>

            <div class="form-group">
                <label for="vertical">Vertical <span class="required">*</span></label>
                <input type="text" id="vertical" name="vertical" required>
            </div>

            <!-- Backlog -->
            <div class="form-group" style="grid-column: 1 / -1;">
                <label for="backlogInput">Backlog</label>
                <input type="text" id="backlogInput" placeholder="Digite e pressione Enter">
                <ul id="backlogLista" class="tag-list"></ul>
            </div>

            <!-- Seguimento -->
            <div class="form-group" style="grid-column: 1 / -1;">
                <label for="jornadaInput">Seguimento (Jornada)</label>
                <input type="text" id="jornadaInput" placeholder="Digite e pressione Enter">
                <ul id="jornadaLista" class="tag-list"></ul>
            </div>

            <!-- Messagem de erro para projeto/backlog ou Seguimento ja cadastraid de erro dinâmica via JS -->
            <div id="mensagemProjeto" class="alert erro" style="grid-column: 1 / -1;"></div>

            <!-- Botões -->
            <div class="form-actions">
                <button type="reset" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Limpar
                </button>
                <button type="submit" class="btn btn-primary">
                    Cadastrar Projeto
                </button>
            </div>

        </form>
    </div>

    <div class="table-card">
        <h3 class="section-form-title">Projetos cadastrados</h3>
        <table>
            <thead>
                <tr>
                    <th>Código</th>
                    <th>Nome</th>
                    <th>Vertical</th>
                    <th>Backlogs</th>
                    <th>Seguimentos</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for item in resultados %}
                <tr>
                    <td>{{ item.codigo }}</td>
                    <td>{{ item.nome }}</td>
                    <td>{{ item.vertical }}</td>
                    <td>
                        {% for b in item.backlogs %}
                        <span class="tag">{{ b }}</span>
                        {% endfor %}
                    </td>
                    <td>
                        {% for j in item.jornadas %}
                        <span class="tag">{{ j }}</span>
                        {% endfor %}
                    </td>
                    <td>
                        <form action="{{ url_for('projeto_bp.deletar_projeto', id=item['id']) }}" method="post"
                            style="display:inline;">
                            <button type="submit" onclick="return confirm('Deseja realmente excluir este projeto?')"
                                class="btn-icon-only">
                                <i class="fas fa-trash-alt btn-remover"></i>
                            </button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" style="text-align: center;">Nenhum projeto cadastrado.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>


    <!-- Scripts Validação ao submeter o formulario e Ações dos campos Backlog e Jornada -->
    <script src="{{ url_for('static', filename='js/validar_projeto.js') }}"></script>
    {% endblock %}